<div class="w-full max-w-md mx-auto">
    <div class="flex justify-between">
        <label for="{{ object.get_label }}" class="block text-sm/6 font-medium text-gray-900 dark:text-white">
            {{ object.get_label }}
        </label>

        {% if field_is_optional %}
        <span id="{{ object.get_label }}-optional" class="text-sm/6 text-gray-500 dark:text-gray-400">
            Optional
        </span>
        {% endif %}
    </div>

    <div class="mt-2 border border-gray-300 rounded-md relative">
        <canvas id="signature" class="w-full h-40 bg-white rounded-md"></canvas>
        <button type="button" id="clearSignature"
            class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 text-xs rounded hover:bg-red-600">
            Clear
        </button>
    </div>

    <input type="hidden" name="signatureData" id="signatureData">
</div>

<script>
    const canvas = document.getElementById('signature');
    const ctx = canvas.getContext('2d');
    let drawing = false;

    // Adjust for high DPI screens
    function resizeCanvas() {
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        canvas.width = canvas.offsetWidth * ratio;
        canvas.height = canvas.offsetHeight * ratio;
        ctx.scale(ratio, ratio);
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#000';
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    canvas.addEventListener('mousedown', () => drawing = true);
    canvas.addEventListener('mouseup', () => drawing = false);
    canvas.addEventListener('mouseout', () => drawing = false);

    canvas.addEventListener('mousemove', (e) => {
        if (!drawing) return;
        const rect = canvas.getBoundingClientRect();
        ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
    });

    document.getElementById('clearSignature').addEventListener('click', () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        document.getElementById('signatureData').value = '';
    });

    // Optional: Save signature to hidden input on form submit
    canvas.closest('form')?.addEventListener('submit', () => {
        document.getElementById('signatureData').value = canvas.toDataURL();
    });
</script>